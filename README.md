
# Сервис остатков товаров в магазине

Этот проект представляет REST API для управления остатками товаров в магазинах. Реализован с использованием **Node.js**, **ExpressJS**, и **PostgreSQL**, с четкой модульной архитектурой для обеспечения гибкости и масштабируемости.

---

## Технологический стек
- **JavaScript**
- **Node.js**
- **Express.js**
- **PostgreSQL**
- **SQL**
- **Swagger**

---

## Установка и запуск проекта

### 1. Клонирование репозитория
```bash
git clone https://github.com/BaitemirAsanbaev/shop-inventory.git
```

### 2. Установка зависимостей
Перейдите в директорию проекта и установите все необходимые библиотеки:
```bash
npm install
```

### 3. Создание базы данных
Создайте базу данных в PostgreSQL:
```sql
CREATE DATABASE inventory;
```

### 4. Создание таблиц
Используйте команды SQL, указанные в файле `db/db.sql`, для создания необходимых таблиц.

### 5. Настройка файла окружения
Скопируйте пример файла `.example.env` и заполните его корректными значениями:
```bash
cp .example.env .env
```

### 6. Запуск приложения
```bash
npm start
```

---

## Функционал

- **CRUD для товаров, магазинов и остатков**
- **Поиск товаров по PLU или имени**
- **Получение остатков с фильтрацией:**
  - По PLU товара
  - По ID магазина
  - По количеству на полке (в заданном диапазоне)
  - По количеству в заказе (в заданном диапазоне)
- **Регулирование остатков** (увеличение/уменьшение количества на полке и в заказе)
- **Заказы и возвраты товаров**

---

## Структура проекта

### `/db`
- SQL файл для создания таблиц
- JS файл для подключения к базе данных

### `/utils`
- Обработка ошибок
- Валидация
- Swagger-документация
- Логгер

### `/inventory, /item, /shop`
Модули для работы с товарами, магазинами и остатками. Каждый модуль включает:
- **`router.js`**  
  Маршруты API с документацией Swagger и привязанными middleware для валидации.
- **`controller.js`**  
  Обработка запросов клиента, вызов сервисов, валидация, отправка ответов.
- **`service.js`**  
  Бизнес-логика, обработка данных, вызов методов из репозитория.
- **`repository.js`**  
  Работа с базой данных, выполнение SQL-запросов.

---

## Технические и архитектурные решения

### 1. **Модульная архитектура**
Проект организован в модули, каждый из которых изолирован и отвечает за работу с определенной сущностью.  
Это позволяет легко добавлять новые модули и функционал, не затрагивая другие части приложения.

### 2. **Эндпоинты для управления остатками**
Для управления остатками было решено предоставить отдельные эндпоинты для увеличения и уменьшения количества на полке и в заказе.  
Это улучшает читаемость кода и упрощает масштабируемость по сравнению с объединением логики в один универсальный эндпоинт.

### 3. **Эндпоинты для заказа и возврата**
Эндпоинты `order` и `refund` реализуют связанные бизнес-процессы, одновременно изменяя остатки на полке и в заказе.

---

## Документация API
Документация доступна по адресу `/api-docs` после запуска приложения. Для её генерации используется **Swagger**.

